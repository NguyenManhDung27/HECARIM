{% extends "base.html" %}

{% block title %}Bảng điều khiển Bác sĩ{% endblock %}

{% block sidebar_menu %}
<div class="nav-item">
    <a href="{{ url_for('doctor.dashboard') }}" class="nav-link active">
        <i class="fas fa-home"></i>
        Tổng quan
    </a>
</div>
<div class="nav-item">
    <a href="{{ url_for('doctor.medical_records') }}" class="nav-link">
        <i class="fas fa-file-medical"></i>
        Hồ sơ bệnh án
    </a>
</div>
<div class="nav-item">
    <a href="{{ url_for('doctor.prescriptions') }}" class="nav-link">
        <i class="fas fa-prescription"></i>
        Kê đơn thuốc
    </a>
</div>
<div class="nav-item">
    <a href="{{ url_for('doctor.patients') }}" class="nav-link">
        <i class="fas fa-users"></i>
        Danh sách bệnh nhân
    </a>
</div>
<div class="nav-item">
    <a href="{{ url_for('doctor.profile') }}" class="nav-link">
        <i class="fas fa-user"></i>
        Thông tin cá nhân
    </a>
</div>
{% endblock %}

{% block page_title %}Tổng quan{% endblock %}

{% block content %}
<!-- Today's Stats -->
<div class="row">
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h3 class="card-title text-primary">
                    <i class="fas fa-calendar"></i>
                    Lịch hẹn hôm nay
                </h3>
                <h2 class="mb-0">{{ stats.total_appointments }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h3 class="card-title text-success">
                    <i class="fas fa-check-circle"></i>
                    Đã khám
                </h3>
                <h2 class="mb-0">{{ stats.completed_appointments }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h3 class="card-title text-warning">
                    <i class="fas fa-clock"></i>
                    Đang chờ
                </h3>
                <h2 class="mb-0">{{ stats.waiting_appointments }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h3 class="card-title text-info">
                    <i class="fas fa-notes-medical"></i>
                    Đơn thuốc
                </h3>
                <h2 class="mb-0">{{ stats.prescriptions }}</h2>
            </div>
        </div>
    </div>
</div>

<!-- Today's Appointments -->
<div class="card my-4">
    <div class="card-header">
        <h2 class="card-title mb-0">Lịch khám hôm nay</h2>
    </div>
    <div class="card-body">
        {% if appointments %}
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Giờ</th>
                        <th>Mã BN</th>
                        <th>Họ và tên</th>
                        <th>Loại khám</th>
                        <th>Trạng thái</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    {% for appointment in appointments %}
                    <tr>
                        <td>{{ appointment.time }}</td>
                        <td>{{ appointment.patient_id }}</td>
                        <td>{{ appointment.patient_name }}</td>
                        <td>{{ appointment.type }}</td>
                        <td>
                            <span class="badge badge-{{ appointment.status_class }}">
                                {{ appointment.status }}
                            </span>
                        </td>
                        <td>
                            {% if appointment.status != 'completed' %}
                            <a href="{{ url_for('doctor.examination', appointment_id=appointment._id) }}" 
                               class="btn btn-primary btn-sm">
                                <i class="fas fa-stethoscope"></i>
                                Khám bệnh
                            </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-center text-muted">Không có lịch hẹn nào cho hôm nay</p>
        {% endif %}
    </div>
</div>

<!-- Monitored Patients -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title mb-0">Bệnh nhân cần theo dõi</h2>
    </div>
    <div class="card-body">
        {% if monitored_patients %}
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Mã BN</th>
                        <th>Họ và tên</th>
                        <th>Chẩn đoán</th>
                        <th>Lần khám gần nhất</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    {% for patient in monitored_patients %}
                    <tr>
                        <td>{{ patient.patientId }}</td>
                        <td>{{ patient.personalInfo.fullName }}</td>
                        <td>{{ patient.diagnosis }}</td>
                        <td>{{ patient.lastVisit.strftime('%d/%m/%Y') if patient.lastVisit else 'Chưa có' }}</td>
                        <td>
                            <a href="{{ url_for('doctor.patient_details', patient_id=patient._id) }}" 
                               class="btn btn-secondary btn-sm">
                                <i class="fas fa-eye"></i>
                                Chi tiết
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-center text-muted">Không có bệnh nhân nào cần theo dõi</p>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Auto-refresh the page every 5 minutes
    setTimeout(function() {
        window.location.reload();
    }, 300000);
</script>
{% endblock %}